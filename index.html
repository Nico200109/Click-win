<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Click&Win – Enchères</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
 font-family:Arial, sans-serif;
 background:#f4f6f9;
 margin:0;
 text-align:center;
}
header{
 background:#111;
 color:#fff;
 padding:15px;
 font-size:26px;
}
nav{
 margin:15px 0;
}
nav a{
 margin:0 10px;
 text-decoration:none;
 color:#3498db;
 font-weight:bold;
}
.container{
 display:flex;
 justify-content:center;
 gap:20px;
 margin:30px;
 flex-wrap:wrap;
}
.card{
 background:#fff;
 width:220px;
 padding:15px;
 border-radius:12px;
 box-shadow:0 6px 20px rgba(0,0,0,.1);
}
.card img{
 width:100%;
 height:120px;
 object-fit:contain;
}
.price{
 font-size:28px;
 font-weight:bold;
 margin:10px 0;
 color:#27ae60;
}
button{
 width:100%;
 padding:10px;
 border:none;
 border-radius:8px;
 font-size:15px;
 cursor:pointer;
}
.block{
 background:#3498db;
 color:#fff;
}
.pay{
 background:#2ecc71;
 color:#fff;
 display:none;
}
.timer{
 margin-top:8px;
 font-size:14px;
 color:#e67e22;
}
.wait{
 padding:40px 0;
 font-size:16px;
 color:#555;
}
</style>
</head>

<body>

<header>Click&Win</header>

<nav>
 <a href="index.html">Enchères</a>
 <a href="how.html">Comment ça marche</a>
 <a href="winners.html">Gagnants</a>
</nav>

<div class="container">
 <div class="card" id="card1"></div>
 <div class="card" id="card2"></div>
</div>

<script>
const products=[
 {name:"iPhone 15",price:120,img:"https://upload.wikimedia.org/wikipedia/commons/f/fa/IPhone_15_Pro_Black_Titanium.png"},
 {name:"TV 4K",price:900,img:"https://upload.wikimedia.org/wikipedia/commons/5/5f/LED_TV.png"},
 {name:"Console de jeux",price:500,img:"https://upload.wikimedia.org/wikipedia/commons/4/4e/PS5_console.png"},
 {name:"Week-end Disneyland",price:700,img:"https://upload.wikimedia.org/wikipedia/commons/d/d4/Disneyland_Paris_Entrance.jpg"}
];

function saveWinner(name,price){
 const list=JSON.parse(localStorage.getItem("winners")||"[]");
 list.unshift({name,price,date:new Date().toLocaleString()});
 localStorage.setItem("winners",JSON.stringify(list.slice(0,10)));
}

function createCard(container){
 const id=container.id;
 let product,price,blocked=false,rotating=false;
 let priceInterval,payInterval,rotateInterval;
 let blockTime=0,rotateTime=0;

 function saveState(){
  localStorage.setItem("auction_"+id,JSON.stringify({
   product,price,blocked,rotating,blockTime,rotateTime
  }));
 }

 function loadState(){
  const data=JSON.parse(localStorage.getItem("auction_"+id));
  if(!data) return false;
  product=data.product;
  price=data.price;
  blocked=data.blocked;
  rotating=data.rotating;
  blockTime=data.blockTime;
  rotateTime=data.rotateTime;
  render();
  if(rotating) resumeRotate();
  else if(blocked) resumeBlock();
  else startDrop();
  return true;
 }

 function render(){
  container.innerHTML=`
   <img src="${product.img}">
   <h3>${product.name}</h3>
   <div class="price">${price} €</div>
   <button class="block">Bloquer le prix</button>
   <button class="pay">Payer maintenant</button>
   <div class="timer"></div>
  `;
  container.querySelector(".block").onclick=freeze;
  container.querySelector(".pay").onclick=pay;
  container.querySelector(".pay").style.display=blocked?"block":"none";
  container.querySelector(".block").style.display=blocked?"none":"block";
 }

 function newProduct(){
  product=products[Math.floor(Math.random()*products.length)];
  price=product.price;
  blocked=false;
  rotating=false;
  blockTime=0;
  rotateTime=0;
  render();
  startDrop();
  saveState();
 }

 function startDrop(){
  priceInterval=setInterval(()=>{
   if(blocked||rotating) return;
   price--;
   if(price<=10){
    price=10;
    clearInterval(priceInterval);
    startRotate();
    return;
   }
   container.querySelector(".price").innerText=price+" €";
   saveState();
  },300);
 }

 function freeze(){
  blocked=true;
  clearInterval(priceInterval);
  blockTime=10;
  container.querySelector(".block").style.display="none";
  container.querySelector(".pay").style.display="block";
  resumeBlock();
 }

 function resumeBlock(){
  container.querySelector(".timer").innerText="Temps pour payer : "+blockTime+"s";
  payInterval=setInterval(()=>{
   blockTime--;
   container.querySelector(".timer").innerText="Temps pour payer : "+blockTime+"s";
   saveState();
   if(blockTime<=0){
    clearInterval(payInterval);
    blocked=false;
    container.querySelector(".pay").style.display="none";
    container.querySelector(".block").style.display="block";
    container.querySelector(".timer").innerText="";
    startDrop();
    saveState();
   }
  },1000);
 }

 function pay(){
  saveWinner(product.name,price);
  clearInterval(priceInterval);
  clearInterval(payInterval);
  startRotate();
 }

 function startRotate(){
  rotating=true;
  rotateTime=5;
  container.innerHTML=`<div class="wait">⏳ Nouvel objet dans ${rotateTime}s</div>`;
  resumeRotate();
 }

 function resumeRotate(){
  rotateInterval=setInterval(()=>{
   rotateTime--;
   container.querySelector(".wait").innerText="⏳ Nouvel objet dans "+rotateTime+"s";
   saveState();
   if(rotateTime<=0){
    clearInterval(rotateInterval);
    newProduct();
   }
  },1000);
 }

 if(!loadState()) newProduct();
}

createCard(document.getElementById("card1"));
createCard(document.getElementById("card2"));
</script>

</body>
</html>
 
